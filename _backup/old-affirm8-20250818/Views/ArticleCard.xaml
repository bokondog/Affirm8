<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Affirm8.Views.Catalog.ArticleCard"
             xmlns:local="clr-namespace:Affirm8"
             xmlns:model="clr-namespace:Affirm8.Models"
             xmlns:controls="clr-namespace:Affirm8.Controls"
             xmlns:converter="clr-namespace:Affirm8.Converters"
             x:DataType="local:ArticleCardViewModel" 
             Title="Article">

    <ContentPage.BindingContext>
        <local:ArticleCardViewModel/>
    </ContentPage.BindingContext>

    <ContentPage.Content>
        <ScrollView>
            <StackLayout Spacing="0">
                
                <!-- Article Header -->
                <Grid BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}"
                      Padding="16,20,16,16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Article Image -->
                    <Border Grid.Row="0"
                           WidthRequest="120"
                           HeightRequest="120"
                           HorizontalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8" />
                        </Border.StrokeShape>
                        <Image Source="{Binding Article.ImageUrl}"
                              Aspect="AspectFill" />
                    </Border>

                    <!-- Article Title -->
                    <Label Grid.Row="1" 
                          Text="{Binding Article.Title}"
                          FontSize="24"
                          FontFamily="Roboto-Medium"
                          TextColor="White"
                          HorizontalOptions="Center"
                          HorizontalTextAlignment="Center"
                          Margin="0,16,0,8" />

                    <!-- Article Subtitle -->
                    <Label Grid.Row="2"
                          Text="{Binding Article.Subtitle}"
                          FontSize="16"
                          FontFamily="Roboto-Regular"
                          TextColor="White"
                          Opacity="0.9"
                          HorizontalOptions="Center"
                          HorizontalTextAlignment="Center" />
                </Grid>

                <!-- Article Content -->
                <StackLayout BackgroundColor="{AppThemeBinding Light={DynamicResource BackgroundColorLight}, Dark={DynamicResource BackgroundColorDark}}"
                            Padding="16">
                    
                    <!-- Article Info -->
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <StackLayout Grid.Column="0" Spacing="4">
                            <Label Text="{Binding Article.Author}"
                                  FontSize="14"
                                  FontFamily="Roboto-Medium"
                                  TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}" />
                            <Label Text="{Binding Article.PublishDate, StringFormat='{0:MMM dd, yyyy}'}"
                                  FontSize="12"
                                  FontFamily="Roboto-Regular"
                                  TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight}, Dark={DynamicResource SecondaryTextColorDark}}" />
                        </StackLayout>

                        <!-- Rating -->
                        <StackLayout Grid.Column="1" 
                                    Orientation="Horizontal" 
                                    Spacing="8"
                                    VerticalOptions="Center">
                            <controls:RatingControl Value="{Binding Article.Rating}"
                                                   IsReadOnly="True" />
                            <Label Text="{Binding Article.Rating, StringFormat='{0:F1}'}"
                                  FontSize="14"
                                  FontFamily="Roboto-Regular"
                                  TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight}, Dark={DynamicResource SecondaryTextColorDark}}"
                                  VerticalOptions="Center" />
                        </StackLayout>
                    </Grid>

                    <!-- Article Body -->
                    <Label Text="{Binding Article.Content}"
                          FontSize="16"
                          FontFamily="Roboto-Regular"
                          TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}"
                          LineHeight="1.5"
                          Margin="0,0,0,20" />

                    <!-- Tags -->
                    <Label Text="Tags:" 
                          FontSize="14"
                          FontFamily="Roboto-Medium"
                          TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}"
                          Margin="0,0,0,8" />
                    
                    <CollectionView ItemsSource="{Binding Article.Tags}"
                                   HeightRequest="40">
                        <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Horizontal" 
                                             ItemSpacing="8" />
                        </CollectionView.ItemsLayout>
                        
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="{x:Type x:String}">
                                <Border BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}"
                                       Padding="8,4"
                                       VerticalOptions="Center">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12" />
                                    </Border.StrokeShape>
                                    <Label Text="{Binding .}"
                                          FontSize="12"
                                          FontFamily="Roboto-Regular"
                                          TextColor="White"
                                          VerticalOptions="Center" />
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Action Buttons -->
                    <Grid Margin="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Like Button -->
                        <Button Grid.Column="0"
                               Text="â¤ï¸ Like"
                               BackgroundColor="Transparent"
                               TextColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}"
                               FontFamily="Roboto-Regular"
                               FontSize="14"
                               Command="{Binding LikeCommand}" />

                        <!-- Share Button -->
                        <Button Grid.Column="1"
                               Text="ðŸ“¤ Share"
                               BackgroundColor="Transparent"
                               TextColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}"
                               FontFamily="Roboto-Regular"
                               FontSize="14"
                               Command="{Binding ShareCommand}" />

                        <!-- Bookmark Button -->
                        <Button Grid.Column="2"
                               Text="ðŸ”– Save"
                               BackgroundColor="Transparent"
                               TextColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}"
                               FontFamily="Roboto-Regular"
                               FontSize="14"
                               Command="{Binding BookmarkCommand}" />
                    </Grid>
                </StackLayout>

                <!-- Comments Section -->
                <StackLayout BackgroundColor="{AppThemeBinding Light={DynamicResource BackgroundColorLight}, Dark={DynamicResource BackgroundColorDark}}"
                            Padding="16,0,16,16">
                    
                    <Label Text="Comments"
                          FontSize="18"
                          FontFamily="Roboto-Medium"
                          TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}"
                          Margin="0,0,0,12" />

                    <CollectionView ItemsSource="{Binding Comments}"
                                   HeightRequest="300">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="local:Comment">
                                <Border Margin="0,4"
                                       Padding="12"
                                       BackgroundColor="{AppThemeBinding Light={DynamicResource CardBackgroundLight}, Dark={DynamicResource CardBackgroundDark}}"
                                       Stroke="{AppThemeBinding Light={DynamicResource BorderColorLight}, Dark={DynamicResource BorderColorDark}}"
                                       StrokeThickness="0.5">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8" />
                                    </Border.StrokeShape>
                                    
                                    <StackLayout Spacing="4">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            
                                            <Label Grid.Column="0"
                                                  Text="{Binding AuthorName}"
                                                  FontSize="14"
                                                  FontFamily="Roboto-Medium"
                                                  TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}" />
                                            
                                            <Label Grid.Column="1"
                                                  Text="{Binding Date, StringFormat='{0:MMM dd}'}"
                                                  FontSize="12"
                                                  FontFamily="Roboto-Regular"
                                                  TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight}, Dark={DynamicResource SecondaryTextColorDark}}" />
                                        </Grid>
                                        
                                        <Label Text="{Binding Content}"
                                              FontSize="14"
                                              FontFamily="Roboto-Regular"
                                              TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}" />
                                    </StackLayout>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </StackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>