<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Affirm8.Views.LoginPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Affirm8.ViewModels"
             xmlns:converters="clr-namespace:Affirm8.Converters"
             x:DataType="viewmodels:AuthenticationViewModel"
             Title="Welcome to Affirm8"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource OffBlack}}">
    
    <ContentPage.Resources>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        <converters:IsNotNullConverter x:Key="IsNotNullConverter" />
    </ContentPage.Resources>

    <ScrollView Padding="20">
        <StackLayout Spacing="20" VerticalOptions="CenterAndExpand">
            
            <!-- Logo/Title Section -->
            <StackLayout Spacing="10" Margin="0,40,0,40">
                <Label Text="ðŸŒŸ Affirm8" 
                       FontSize="48" 
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}" />
                <Label Text="Spread kindness, one message at a time" 
                       FontSize="16" 
                       HorizontalOptions="Center"
                       TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
            </StackLayout>

            <!-- Authentication Form -->
            <Border BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeThickness="1"
                    Padding="20"
                    StrokeShape="RoundRectangle 12">
                
                <StackLayout Spacing="15">
                    
                    <!-- Mode Toggle Header -->
                    <Label FontSize="24"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}">
                        <Label.Triggers>
                            <DataTrigger TargetType="Label" Binding="{Binding IsLoginMode}" Value="True">
                                <Setter Property="Text" Value="Welcome Back!" />
                            </DataTrigger>
                            <DataTrigger TargetType="Label" Binding="{Binding IsLoginMode}" Value="False">
                                <Setter Property="Text" Value="Create Account" />
                            </DataTrigger>
                        </Label.Triggers>
                    </Label>
                    
                    <!-- Email Entry -->
                    <StackLayout Spacing="5">
                        <Label Text="Email" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
                        <Entry Text="{Binding Email}" 
                               Placeholder="Enter your email"
                               Keyboard="Email"
                               IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                               BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}"
                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                    </StackLayout>

                    <!-- Password Entry -->
                    <StackLayout Spacing="5">
                        <Label Text="Password" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
                        <Entry Text="{Binding Password}" 
                               Placeholder="Enter your password"
                               IsPassword="True"
                               IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                               BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}"
                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                    </StackLayout>

                    <!-- Nickname Entry (Register Mode Only) -->
                    <StackLayout Spacing="5" 
                                 IsVisible="{Binding IsLoginMode, Converter={StaticResource InverseBoolConverter}}">
                        <Label Text="Nickname" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" />
                        <Entry Text="{Binding NickName}" 
                               Placeholder="Choose a nickname"
                               IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                               BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray800}}"
                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />
                    </StackLayout>

                    <!-- Error Message -->
                    <Label Text="{Binding ErrorMessage}" 
                           IsVisible="{Binding ErrorMessage, Converter={StaticResource IsNotNullConverter}}"
                           FontSize="14"
                           TextColor="Red"
                           HorizontalOptions="Center" />

                    <!-- Action Buttons -->
                    <StackLayout Spacing="10" Margin="0,10,0,0">
                        
                        <!-- Login/Register Button -->
                        <Button IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                FontSize="16"
                                FontAttributes="Bold"
                                HeightRequest="50"
                                CornerRadius="8">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsLoginMode}" Value="True">
                                    <Setter Property="Text" Value="Login" />
                                    <Setter Property="Command" Value="{Binding LoginCommand}" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" Binding="{Binding IsLoginMode}" Value="False">
                                    <Setter Property="Text" Value="Create Account" />
                                    <Setter Property="Command" Value="{Binding RegisterCommand}" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>

                        <!-- Loading Indicator -->
                        <ActivityIndicator IsVisible="{Binding IsLoading}" 
                                           IsRunning="{Binding IsLoading}"
                                           Color="{StaticResource Primary}"
                                           HeightRequest="30" />

                        <!-- Mode Switch Button -->
                        <Button Command="{Binding SwitchModeCommand}"
                                IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Primary}"
                                FontSize="14"
                                HeightRequest="40">
                            <Button.Triggers>
                                <DataTrigger TargetType="Button" Binding="{Binding IsLoginMode}" Value="True">
                                    <Setter Property="Text" Value="Need an account? Sign up" />
                                </DataTrigger>
                                <DataTrigger TargetType="Button" Binding="{Binding IsLoginMode}" Value="False">
                                    <Setter Property="Text" Value="Already have an account? Sign in" />
                                </DataTrigger>
                            </Button.Triggers>
                        </Button>
                        
                    </StackLayout>
                </StackLayout>
            </Border>

            <!-- Quick Test Accounts Info -->
            <Border BackgroundColor="{AppThemeBinding Light={StaticResource Gray50}, Dark={StaticResource Gray900}}"
                    Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                    StrokeThickness="1"
                    Padding="15"
                    StrokeShape="RoundRectangle 8"
                    Margin="0,20,0,0">
                
                <StackLayout Spacing="8">
                    <Label Text="ðŸ’¡ Test Accounts Available" 
                           FontSize="14" 
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray700}, Dark={StaticResource Gray300}}" />
                    <Label Text="Email: sunflower@test.com â€¢ Password: password123" 
                           FontSize="12"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                    <Label Text="Email: kindsoul@test.com â€¢ Password: password123" 
                           FontSize="12"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
                </StackLayout>
            </Border>
            
        </StackLayout>
    </ScrollView>
</ContentPage>
