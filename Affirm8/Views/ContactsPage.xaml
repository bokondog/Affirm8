<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Affirm8.Views.Navigation.ContactsPage"
             xmlns:local="clr-namespace:Affirm8"
             x:DataType="local:ContactsPageViewModel" 
             Title="Contacts">

    <ContentPage.BindingContext>
        <local:ContactsPageViewModel/>
    </ContentPage.BindingContext>

    <ContentPage.Content>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Padding="16,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0"
                       Text="Contacts"
                       FontSize="24"
                       FontFamily="Roboto-Medium"
                       TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}"
                       VerticalOptions="Center" />

                <Button Grid.Column="1"
                        Text="âž•"
                        BackgroundColor="Transparent"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}"
                        FontSize="20"
                        WidthRequest="40"
                        HeightRequest="40"
                        Command="{Binding AddCommand}" />
            </Grid>

            <!-- Search Bar -->
            <SearchBar Grid.Row="1"
                      Placeholder="Search contacts..."
                      Text="{Binding SearchText}"
                      SearchCommand="{Binding SearchCommand}"
                      Margin="16,0" />

            <!-- Contacts List -->
            <CollectionView Grid.Row="2"
                           ItemsSource="{Binding Contacts}"
                           SelectionMode="Single"
                           SelectedItem="{Binding SelectedContact}"
                           SelectionChangedCommand="{Binding ContactSelectionChangedCommand}"
                           BackgroundColor="Transparent"
                           Margin="8,8,8,0">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="local:Contact">
                        <Border Margin="8,4"
                               Padding="16,12"
                               BackgroundColor="{AppThemeBinding Light={DynamicResource CardBackgroundLight}, Dark={DynamicResource CardBackgroundDark}}"
                               Stroke="{AppThemeBinding Light={DynamicResource BorderColorLight}, Dark={DynamicResource BorderColorDark}}"
                               StrokeThickness="0.5">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8" />
                            </Border.StrokeShape>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Avatar -->
                                <Border Grid.Column="0"
                                       WidthRequest="50"
                                       HeightRequest="50"
                                       BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}">
                                    <Border.StrokeShape>
                                        <Ellipse />
                                    </Border.StrokeShape>
                                    <Label Text="{Binding Initials}"
                                          TextColor="White"
                                          FontFamily="Roboto-Medium"
                                          FontSize="18"
                                          HorizontalOptions="Center"
                                          VerticalOptions="Center" />
                                </Border>

                                <!-- Contact Info -->
                                <StackLayout Grid.Column="1" 
                                            Spacing="4" 
                                            Margin="16,0"
                                            VerticalOptions="Center">
                                    <Label Text="{Binding Name}"
                                          FontSize="16"
                                          FontFamily="Roboto-Medium"
                                          TextColor="{AppThemeBinding Light={DynamicResource PrimaryTextColorLight}, Dark={DynamicResource PrimaryTextColorDark}}" />
                                    
                                    <Label Text="{Binding PhoneNumber}"
                                          FontSize="14"
                                          FontFamily="Roboto-Regular"
                                          TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight}, Dark={DynamicResource SecondaryTextColorDark}}"
                                          IsVisible="{Binding HasPhoneNumber}" />
                                    
                                    <Label Text="{Binding Email}"
                                          FontSize="14"
                                          FontFamily="Roboto-Regular"
                                          TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight}, Dark={DynamicResource SecondaryTextColorDark}}"
                                          IsVisible="{Binding HasEmail}" />
                                </StackLayout>

                                <!-- Action Buttons -->
                                <StackLayout Grid.Column="2" 
                                            Orientation="Horizontal"
                                            Spacing="8"
                                            VerticalOptions="Center">
                                    
                                    <!-- Call Button -->
                                    <Button Text="ðŸ“ž"
                                           BackgroundColor="Transparent"
                                           TextColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}"
                                           FontSize="18"
                                           WidthRequest="40"
                                           HeightRequest="40"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type local:ContactsPageViewModel}}, Path=CallCommand}"
                                           CommandParameter="{Binding .}"
                                           IsVisible="{Binding HasPhoneNumber}" />

                                    <!-- Message Button -->
                                    <Button Text="ðŸ’¬"
                                           BackgroundColor="Transparent"
                                           TextColor="{AppThemeBinding Light={DynamicResource PrimaryColorLight}, Dark={DynamicResource PrimaryColorDark}}"
                                           FontSize="18"
                                           WidthRequest="40"
                                           HeightRequest="40"
                                           Command="{Binding Source={RelativeSource AncestorType={x:Type local:ContactsPageViewModel}}, Path=MessageCommand}"
                                           CommandParameter="{Binding .}" />
                                </StackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <!-- Empty View -->
                <CollectionView.EmptyView>
                    <StackLayout HorizontalOptions="Center" 
                                VerticalOptions="Center"
                                Spacing="16">
                        <Label Text="ðŸ‘¥"
                              FontSize="48"
                              HorizontalOptions="Center" />
                        <Label Text="No contacts found"
                              FontSize="18"
                              FontFamily="Roboto-Medium"
                              HorizontalOptions="Center"
                              TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight}, Dark={DynamicResource SecondaryTextColorDark}}" />
                        <Label Text="Add your first contact"
                              FontSize="14"
                              FontFamily="Roboto-Regular"
                              HorizontalOptions="Center"
                              TextColor="{AppThemeBinding Light={DynamicResource SecondaryTextColorLight}, Dark={DynamicResource SecondaryTextColorDark}}" />
                    </StackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </Grid>
    </ContentPage.Content>
</ContentPage>